<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Wicket exception on shutdown – java.lang.NoClas­sDefFoundError:
org/apache/wic­ket/util/lang/Pro­pertyResolver - Ondřej Žižka</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="My personal web">
    <meta name="author" content="Ondřej Žižka">
    <meta name="generator" content="JBake">


    <link rel="stylesheet" href="../../../../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../../../css/asciidoctor.css">
    <link rel="stylesheet" href="../../../../../css/base.css">
    <link rel="stylesheet" href="../../../../../css/doc-body.css">
    <link rel="stylesheet" href="../../../../../css/prettify.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="../../../../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../../../favicon.ico">
</head>
<body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.zizka.ch/">Ondřej Žižka</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../../../../../index.html">Blog</a></li>
            <li><a href="../../../../../archive.html">Archive</a></li>
            <li><a href="../../../../../tags">Tags</a></li>

            <li><a href="../../../../../about.html">About Me</a></li>
            <li><a href="../../../../../feed.xml">RSS feed</a></li>
            <li><a href="../../../../../sitemap.xml">Sitemap</a></li>
            <!--
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
            -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

	<div class="page-header">
        <h1>Wicket exception on shutdown – java.lang.NoClas­sDefFoundError:
org/apache/wic­ket/util/lang/Pro­pertyResolver - Ondřej Žižka</h1>
	</div>

	<div class="date"><em>2012-12-31</em></div>

	<div class="doc-body"><h3>Wicket exception on shutdown – java.lang.NoClas­sDefFoundError:
org/apache/wic­ket/util/lang/Pro­pertyResolver</h3>

<p>This happens when I undeploy a Wicket 1.4.9 application (remove the webapp
dir) on Tomcat 6.0.29:</p>

<pre
class="plain"><code>Nov 25, 2010 11:30:49 PM org.apache.catalina.startup.HostConfig checkResources
INFO: Undeploying context []
Nov 25, 2010 11:30:49 PM org.apache.catalina.startup.HostConfig checkResources
WARNING: Error while removing context []
java.lang.NoClassDefFoundError: org/apache/wicket/util/lang/PropertyResolver
        at org.apache.wicket.Application.internalDestroy(Application.java:952)
        at org.apache.wicket.protocol.http.WebApplication.internalDestroy(WebApplication.java:527)
        at org.apache.wicket.protocol.http.WicketFilter.destroy(WicketFilter.java:179)
        at org.apache.catalina.core.ApplicationFilterConfig.release(ApplicationFilterConfig.java:357)
        at org.apache.catalina.core.StandardContext.filterStop(StandardContext.java:4036)
        at org.apache.catalina.core.StandardContext.stop(StandardContext.java:4768)
        at org.apache.catalina.core.ContainerBase.removeChild(ContainerBase.java:924)
        at org.apache.catalina.startup.HostConfig.checkResources(HostConfig.java:1174)
        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1342)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:303)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
        at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1337)
        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1601)
        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)
        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1590)
        at java.lang.Thread.run(Thread.java:662)
Caused by: java.lang.ClassNotFoundException: org.apache.wicket.util.lang.PropertyResolver
        at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1645)
        at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1491)
        ... 16 more
Nov 25, 2010 11:30:49 PM org.apache.catalina.core.ContainerBase stop
INFO: Container org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/].[apiServlet] has not been started
Nov 25, 2010 11:30:49 PM org.apache.catalina.core.ContainerBase stop
INFO: Container org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/].[jsp] has not been started
Nov 25, 2010 11:30:49 PM org.apache.catalina.core.ContainerBase stop
INFO: Container org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/].[default] has not been started
Nov 25, 2010 11:30:49 PM org.apache.catalina.startup.HostConfig checkResources
WARNING: Error during context [] destroy
java.lang.NoClassDefFoundError: org/apache/wicket/util/lang/PropertyResolver
        at org.apache.wicket.Application.internalDestroy(Application.java:952)
        at org.apache.wicket.protocol.http.WebApplication.internalDestroy(WebApplication.java:527)
        at org.apache.wicket.protocol.http.WicketFilter.destroy(WicketFilter.java:179)
        at org.apache.catalina.core.ApplicationFilterConfig.release(ApplicationFilterConfig.java:357)
        at org.apache.catalina.core.StandardContext.filterStop(StandardContext.java:4036)
        at org.apache.catalina.core.StandardContext.stop(StandardContext.java:4768)
        at org.apache.catalina.core.ContainerBase.destroy(ContainerBase.java:1164)
        at org.apache.catalina.core.StandardContext.destroy(StandardContext.java:4868)
        at org.apache.catalina.startup.HostConfig.checkResources(HostConfig.java:1180)
        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1342)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:303)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
        at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1337)
        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1601)
        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)
        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1590)
        at java.lang.Thread.run(Thread.java:662)</code></pre>

<h4>Solution</h4>

<p>From <a
href="http://www.mail-archive.com/users&#64;wicket.apache.org/msg49863.html">http://www.mail-archive.com/…sg49863.html</a>
:</p>

<p>Alexandros Karypidis:</p>

<blockquote>
	<p>Sun, 21 Mar 2010 02:58:42 –0700<br />
	Ok, I've pinpointed the underlying cause. Indeed, the file is simply removed
	before the destroy() method has a chance to clean up. I verified this by using
	this ugly hack:</p>

	<ol>
		<li>Adding a field:
			<p><code>private InputStream wicketJarProtector;</code></p>
		</li>

		<li>In <code>WicketFilter.init()</code> I open the wicket jar to „protect“
		it from deletion:
			<p><code>wicketJarProtector = filterConfig.getServletContext().getResourceAsStream("/WEB-INF/lib/wicket.jar");</code></p>
		</li>

		<li>In <code>WicketFilter.destroy()</code> I close the file handle:
			<p><code>wicketJarProtector.close();</code></p>
		</li>
	</ol>

	<p>This prevents the file from being deleted, undeployment completes
	successfully.</p>

	<p>I'm not sure how to „properly“ fix this… Any ideas?</p>
</blockquote>

<p>Igor Vaynberg:</p>

<blockquote>
	<p>I can kind of see what is going on, the YourApplication class is loaded
	using a different classloader then the wicket jar. and tomcat cleans it up. fair
	enough. but, YourApplication class extends Application which is inside the jar,
	so tomcat should not be cleaning it up…makes no sense. How can the entire jar
	be gone if one of the classes that was loaded from it is still being used. It
	may be an optimization they do but its may be backfiring in this particular
	case. You may have to use your jar protector as a permanent workaround.</p>

	<ul>
		<li>igor</li>
	</ul>
</blockquote>
</div>

	<hr />


    <!-- Facebook comments -->
        <div class="fb-comments" data-href="http://www.zizka.ch/pages/programovani/java/web/wicket/wicket-NoClassDefFoundError-PropertyResolver.html" data-width="800" data-numposts="5"></div>

    </div>
    <div id="push"></div>

</div>

<div id="footer">
    <div class="container">
        <p class="muted credit">&copy; 2018 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.3.7</a> | Baked with <a href="http://jbake.org">JBake v2.7.0-SNAPSHOT</a></p>
    </div>
</div>

<script src="../../../../../js/jquery-1.11.1.min.js"></script>
<script src="../../../../../js/bootstrap.min.js"></script>
<script src="../../../../../js/prettify.js"></script>

<!-- Facebook comments -->
<div id="fb-root"></div>
<script>
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/cs_CZ/sdk.js#xfbml=1&version=v3.0';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-4584951-4"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-4584951-4');
</script>

</body>
</html>
