<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Profiles in Spring Framework Configuration - Ondřej Žižka</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="My personal web">
    <meta name="author" content="Ondřej Žižka">
    <meta name="generator" content="JBake">


    <link rel="stylesheet" href="../../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../css/asciidoctor.css">
    <link rel="stylesheet" href="../../../css/base.css">
    <link rel="stylesheet" href="../../../css/doc-body.css">
    <link rel="stylesheet" href="../../../css/prettify.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../favicon.ico">
</head>
<body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.zizka.ch/">Ondřej Žižka</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../../../index.html">Blog</a></li>
            <li><a href="../../../archive.html">Archive</a></li>
            <li><a href="../../../tags">Tags</a></li>

            <li><a href="../../../about.html">About Me</a></li>
            <li><a href="../../../feed.xml">RSS feed</a></li>
            <li><a href="../../../sitemap.xml">Sitemap</a></li>
            <!--
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
            -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

	<div class="page-header">
        <h1>Profiles in Spring Framework Configuration - Ondřej Žižka</h1>
	</div>

	<div class="date"><em>2012-12-16</em></div>

	<div class="doc-body"><h3>Profiles in Spring Framework Configuration</h3> 
<p>Spring is a perfect place to centralize your project's&nbsp;con­figuration. Afterall, that was it's&nbsp;initial purpose.</p> 
<p>Sooner or later, you will want to parametrize your configuration. That means, by setting one parameter, e.g. <code>profile</code>, many configuration details should change.</p> 
<p>I'll show you how to do that.</p> 
<h4>Substitution in Values&nbsp;– <code>PropertyPlaceholderConfigurer</code></h4> 
<p>You can read some properties from a file and use them to substitute some „variables“ in bean properties' values. A&nbsp;typical usage example is JDBC configuration&nbsp;– one for developement and other for release:</p> 
<pre class="brush: xml"><code>&lt;!-- JDBC Datasource --&gt;
&lt;bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
  &lt;property name="driverClassName" value="${jdbc.driver}" /&gt;
  &lt;property name="url" value="${jdbc.url}" /&gt;
  &lt;property name="username" value="${jdbc.username}" /&gt;
  &lt;property name="password" value="${jdbc.password}" /&gt;
&lt;/bean&gt;</code></pre> 
<p>Now you must specify a file where the values of these <code>${...}</code>-enclosed variables, called placeholders, are defined. You can use more files, the later overriding the former.</p> 
<p>Here we use <code>properties/database.properties</code> from the .jar to define „defaults“ and then override some properties in an external&nbsp;file.</p> 
<pre class="brush: xml"><code>&lt;context:property-placeholder location="
  classpath:properties/database.properties,
  file:conf/database.properties" /&gt;</code></pre> 
<p>If you want to keep the possibility of removing the external file and relying solely on the defaults, you might use the <code>ignoreResourceNotFound</code> attribute:</p> 
<pre class="brush: xml"><code>&lt;context:property-placeholder location="
  classpath:properties/database.properties,
  file:conf/database.properties" ignoreResourceNotFound="true" /&gt;</code></pre> 
<p>However, in <code>Spring 2.x</code>, only the <code>location</code> attribute is supported for <code>&lt;context:property-placeholder/&gt;</code> element (this shall <a href="http://jira.springframework.org/browse/SPR-4661">probably work in Spring 3.0</a>). So, you need to define it „old way“&nbsp;– as a&nbsp;bean:</p> 
<pre class="brush: xml"><code>&lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
  &lt;property name="locations" value="
      classpath:properties/database.properties,
      file:conf/database.properties" /&gt;
  &lt;property name="ignoreResourceNotFound" value="true" /&gt;
&lt;/bean&gt;</code></pre> 
<h4>Setting up a Profile&nbsp;– Parametrized Configuration</h4> 
<p>In the preamble, I&nbsp;promissed I'll show how to set up some basic profiling.</p> 
<p>Profiles can be set up using the placeholders in the placeholder configuration itself&nbsp;– e.g. by setting <code>location</code> to <code>file:conf/${profile}/nastaveni.properties</code>. But where does the ${profile} come from, when we still don't have the properties from the files available?</p> 
<p>Spring can substitute placeholders in the definitions of property placeholders using the system properties and evironment variables, that is, what is available from <code>System.getProperty(String)</code> and <code>System.getenv(String)</code>.</p> 
<p>So first, we define the system property, either as a JVM <code>-D</code> parameter, or programatically:</p> 
<pre class="brush: bash"><code>## in the command line:
$ java -Dprofile=testing

// Or in Java:
System.setProperty( "profile", "testing" );</code></pre> 
<p>Then we can set the bean up using all our weapons:</p> 
<pre class="brush: xml"><code>&lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
  &lt;property name="locations" value="
      classpath:properties/database.properties,
      file:nastaveni.properties,
      file:conf/${profile}/nastaveni.properties" /&gt;
  &lt;property name="ignoreResourceNotFound" value="true" /&gt;
  &lt;property name="ignoreUnresolvablePlaceholders" value="true" /&gt;
  &lt;property name="searchSystemEnvironment" value="true" /&gt;
  &lt;property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE" /&gt;
&lt;/bean&gt;</code></pre> 
<p>The <code>searchSystemEnvironment</code> and <code>systemPropertiesModeName</code> have reasonable defaults and can be ommited. For more information, see the <a href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html">PropertyPlace­holderConfigu­rer javadoc</a>.</p> 
<p>See also the oficial (and up-to-date) Spring guide to placeholders and overriding: <a href="http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-extension-factory-postprocessors">3.7.2.&nbsp;Customizing configuration metadata with BeanFactoryPos­tProcessors</a>.</p> 
<h4>Overriding (or Overwriting) default values&nbsp;– <code>PropertyOverrideConfigurer</code></h4> 
<p>When using <code>PropertyPlaceholderConfigurer</code>, you inherently must define the values at least once in some properties file. Sometimes you could assume that the defaults will be rarely needed to be overridden, so you might want to keep the defaults right in the custom beans' configuration in Spring's <code>.xml</code>.</p> 
<p>That is possible with <code>PropertyOverrideConfigurer</code>. Simply configure your bean as usualy:</p> 
<pre class="brush: xml"><code>&lt;bean  name="projectInfo" class="cz.dynawest.springtest.CoolProject"&gt;
  &lt;property name="author" value="Ondřej Žižka" /&gt;
  &lt;property name="maintainer" value="Ondřej Žižka" /&gt;
&lt;/bean&gt;</code></pre> 
<p>Then, you can override some of the properties in a properties file. The syntax of the name is <code>&lt;bean-name&gt;.&lt;property-name&gt;=&lt;value&gt;</code>.</p> 
<pre class="brush: properties"><code>## newProjectInfo.properties
projectInfo.maintainer="Reese Witherspoon"</code></pre> 
<p>The final piece of the puzzle is to create a bean that will apply the value to the&nbsp;bean.</p> 
<pre class="brush: xml"><code>&lt;context:property-override location="classpath:newProjectInfo.properties"/&gt;</code></pre> 
<p>More information on overriding can be found in Spring Reference Documentation&nbsp;– <a href="http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-overrideconfigurer">3.7.2.2.&nbsp;Example: the PropertyOverri­deConfigurer</a> or <a href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/beans/factory/config/PropertyOverrideConfigurer.html">PropertyOverri­deConfigurer JavaDoc</a>.</p></div>

	<hr />


    <!-- Facebook comments -->
        <div class="fb-comments" data-href="http://www.zizka.ch/pages/programovani/java/howto-substitutions_in_spring_configuration-tutorial.html" data-width="800" data-numposts="5"></div>

    </div>
    <div id="push"></div>

</div>

<div id="footer">
    <div class="container">
        <p class="muted credit">&copy; 2018 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.3.7</a> | Baked with <a href="http://jbake.org">JBake v2.7.0-SNAPSHOT</a></p>
    </div>
</div>

<script src="../../../js/jquery-1.11.1.min.js"></script>
<script src="../../../js/bootstrap.min.js"></script>
<script src="../../../js/prettify.js"></script>

<!-- Facebook comments -->
<div id="fb-root"></div>
<script>
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/cs_CZ/sdk.js#xfbml=1&version=v3.0';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-4584951-4"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-4584951-4');
</script>

</body>
</html>
