<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Logování v Javě – log4j a
java.util.logging - Ondřej Žižka</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="My personal web">
    <meta name="author" content="Ondřej Žižka">
    <meta name="generator" content="JBake">


    <link rel="stylesheet" href="../../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../css/asciidoctor.css">
    <link rel="stylesheet" href="../../../css/base.css">
    <link rel="stylesheet" href="../../../css/doc-body.css">
    <link rel="stylesheet" href="../../../css/prettify.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../favicon.ico">
</head>
<body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.zizka.ch/">Ondřej Žižka</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../../../index.html">Blog</a></li>
            <li><a href="../../../archive.html">Archive</a></li>
            <li><a href="../../../tags">Tags</a></li>

            <li><a href="../../../about.html">About Me</a></li>
            <li><a href="../../../feed.xml">RSS feed</a></li>
            <li><a href="../../../sitemap.xml">Sitemap</a></li>
            <!--
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
            -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">

	<div class="page-header">
        <h1>Logování v Javě – log4j a
java.util.logging - Ondřej Žižka</h1>
	</div>

	<div class="date"><em>2012-12-16</em></div>

	<div class="doc-body"><h3>Logování v&nbsp;Javě&nbsp;– <code>log4j</code> a <code>java.util.logging</code></h3> 
<p>Pro logování v&nbsp;Javě se již dlouho používá především <a href="http://logging.apache.org/log4j/"><em>log4j</em></a>, dříve součást projektu <a href="http://commons.apache.org/"><em>Jakarta Commons</em></a>. Postupem času se z&nbsp;log4j stal <em>de facto</em> standard.</p> 
<p>Ovšem pravým standardem se později stalo až API z&nbsp;balíčku <code>java.util.logging</code> v&nbsp;JRE (tuším)&nbsp;1.4.</p> 
<h4>log4j</h4> 
<p><strong>log4j</strong> je komplexnější a dá se podrobněji konfigurovat pomocí konf. souboru (standardně log4j.properties někde v&nbsp;classpath).</p> 
<p>Zde je ukázka konfiguračního souboru pro log4j:</p> 
<pre class="java.properties"><code>log4j.rootLogger=WARN, stdout, file

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d %-5r %-5p [%c] (%t:%x) %m%n

log4j.appender.file=org.apache.log4j.DailyRollingFileAppender
log4j.appender.file.File=WS_klient.log
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=%d %-5r %-5p [%c] (%t:%x) %m%n</code></pre> 
<p>Z&nbsp;hlediska Java kódu je logování s&nbsp;log4j podobné jako s <code>java.util.logging</code>&nbsp;– ukázu tedy viz&nbsp;níže.</p> 
<h4><code>java.util.logging</code></h4> 
<p><strong><code>java.util.logging</code></strong> je zobecnění log4j, je tedy méně komplexní a v&nbsp;konf. souboru lze nastavit jen dost omezeně. Pokud chce širší možnosti (např. Memory Handler), musíte je (v&nbsp;aktuální verzi) nastavit programově.</p> 
<p>Osobně toto API používám víceméně proto, že má v&nbsp;API 6&nbsp;úrovní logování&nbsp;– <code>SEVERE</code>, <code>WARN</code>, <code>INFO</code>, <code>FINE</code>, <code>FINER</code>, <code>FINEST</code>. Dost mi totiž na log4j vadilo, že má jen jeden <code>DEBUG</code>, ale i&nbsp;debug informací chci vidět různě&nbsp;– někdy jen základní hlášky o&nbsp;průběhu, jindy celé výpisy obsahů objektů.</p> 
<p>Ukázka konfiguračního souboru pro <code>java.util.logging</code>:</p> 
<pre class="java.properties"><code># Handlers
handlers = java.util.logging.ConsoleHandler java.util.logging.FileHandler


# Console
java.util.logging.ConsoleHandler.formatter = cz.dynawest.logging.SimplestFormatter
java.util.logging.ConsoleHandler.level = ALL


# File
java.util.logging.FileHandler.level = ALL
java.util.logging.FileHandler.pattern = WS_klient.log
java.util.logging.FileHandler.formatter = cz.dynawest.logging.SingleLineFormatter
java.util.logging.FileHandler.limit = 0
java.util.logging.FileHandler.append = true


# Default global logging level.
.formatter = cz.dynawest.logging.SimplestFormatter
.level = INFO</code></pre> 
<p>Standardně bere <code>java.util.logging</code> nastavení odkudsi z <code>$JAVA_HOME/lib/logging.properties</code>, což je programátorovi samozřejmě k&nbsp;ničemu. Nastavit vlastní konfigurační soubor lze dvěma způsoby:</p> 
<ol> 
 <li>Nastavením cesty k&nbsp;souboru do JVM proměnné <code>java.util.logging.config.file</code>:</li> 
</ol> 
<pre class="bash"><code>java -Djava.util.logging.config.file=logging.properties</code></pre> 
<ol start="2"> 
 <li>Programově:</li> 
</ol> 
<pre class="brush: java"><code>LogManager.getLogManager().readConfiguration(new FileInputStream("logging.properties"));</code></pre> 
<p>V&nbsp;obou případech se pak čte z <code>logging.properties</code> na <em>classpath</em>, tj. např. z&nbsp;vašeho JAR souboru.</p> 
<p>Pro zjednodušení používám zhruba takovýto kód, který respektuje onu proměnnou, ale defaultně bere <code>logging.properties</code>. Uznávám, v&nbsp;log4j takovéto opičárny dělat nemusíte.</p> 
<pre class="brush: java"><code>public class LoggingUtils
{
  private static final Logger log = Logger.getLogger( LoggingUtils.class.getName() );


  /** Sets up logging. Uses "#/logging.properties" as default path. */
  public static void initLogging() {
    initLogging("#/logging.properties");
  }


  /** Sets up logging. */
  public static void initLogging( String filePath ) {
    String logConfigFile = System.getProperty("java.util.logging.config.file", filePath);
    try {
      InputStream is;
      if( logConfigFile.startsWith("#") )
        is = Game.class.getResourceAsStream( logConfigFile.substring(1) );
        // "Use getClass().getClassLoader().findResource("path") instead."
      else
        is = new FileInputStream(logConfigFile);

                        log.info("Načítám konfiguraci logování ze souboru: "+logConfigFile+" (nastaveno v systémové proměnné java.util.logging.config.file)");
      LogManager.getLogManager().readConfiguration( is );
    }catch(IOException ex){
      System.err.println("Chyba při načítání nastavení logování ze souboru ["+logConfigFile+"]. Bude použito výchozí.");
    }
  }

}</code></pre> 
<p>Samotné logování potom provedete takto:</p> 
<pre class="brush: java"><code>class LoggingTest {

  // Získáte logger s nějakým jménem - obvykle se jménem aktuální třídy.
  // Uložíte si ho do privátní statické proměnné - logování je thread-safe.
  private static Logger log = Logger.getLogger("cz.dynawest.test.log.LoggingTest");

  // Někdy se můžete vidět:
  //private Logger log = Logger.getLogger(LoggingTest.class.getName());
  // To se používá kvůli budoucímu refaktoringu; někdy je to i kratší na zápis.


  // V metodách už potom jednoduše logujete:
  public void testLogging(){

    log.info("Testujeme logování.");

  }
}</code></pre> 
<p>Dokumentaci k <code>java.util.logging</code> najdete standardně v&nbsp;<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/logging/package-summary.html">JavaDoc</a>u&nbsp;a v&nbsp;dokumentu <a href="http://java.sun.com/j2se/1.4.2/docs/guide/util/logging/overview.html">Java Logging Overview</a>.</p></div>

	<hr />


    <!-- Facebook comments -->
        <div class="fb-comments" data-href="http://www.zizka.ch/pages/programovani/java/navod_logovani_java.util.logging.html" data-width="800" data-numposts="5"></div>

    </div>
    <div id="push"></div>

</div>

<div id="footer">
    <div class="container">
        <p class="muted credit">&copy; 2018 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.3.7</a> | Baked with <a href="http://jbake.org">JBake v2.7.0-SNAPSHOT</a></p>
    </div>
</div>

<script src="../../../js/jquery-1.11.1.min.js"></script>
<script src="../../../js/bootstrap.min.js"></script>
<script src="../../../js/prettify.js"></script>

<!-- Facebook comments -->
<div id="fb-root"></div>
<script>
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/cs_CZ/sdk.js#xfbml=1&version=v3.0';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-4584951-4"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-4584951-4');
</script>

</body>
</html>
